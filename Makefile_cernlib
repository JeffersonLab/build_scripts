ifeq ($(CERNLIB_WORD_LENGTH), 64-bit)
    MAKEFILE = Makefile_cernlib_Vogt
else
    MAKEFILE = Makefile_cernlib_32bit
endif

ifdef CERNLIB_DIRTAG
    CERNLIB_DIR = $(CERN_LEVEL)^$(CERNLIB_DIRTAG)
else
    CERNLIB_DIR = $(CERN_LEVEL)
endif

BUILD_DIR = $(CERNLIB_DIR)_build

all: make_cernlib_dir

make_build_dir:
	mkdir -p $(BUILD_DIR)

$(BUILD_DIR)/.make_done: make_build_dir
	make -C $(BUILD_DIR) -f $(BUILD_SCRIPTS)/$(MAKEFILE)
	date > $@

make_cernlib_dir: $(BUILD_DIR)/.make_done
	test -L $(CERNLIB_DIR) || ln -s $(BUILD_DIR)/$(CERN_LEVEL) $(CERNLIB_DIR)
