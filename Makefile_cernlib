ifeq ($(CERNLIB_WORD_LENGTH), 64-bit)
    MAKEFILE = Makefile_cernlib_Vogt
else
    MAKEFILE = Makefile_cernlib_32bit
endif

CERNLIB_DIR = $(CERN_LEVEL)

BUILD_DIR = $(CERNLIB_DIR)_build

all: make_cernlib_dir

.check_for_old_style_build:
	@if [[ -e $(CERNLIB_DIR) && ! -L $(CERNLIB_DIR) ]] ; \
	then echo Error in Makefile_cernlib: old-style CERNLIB build found. `pwd`/$(CERNLIB_DIR) is not a symbolic link. To fix try $$\BUILD_SCRIPTS/fix_cernlib_build.sh. Exiting ; \
	exit 1 ; \
	fi

make_build_dir: .check_for_old_style_build
	mkdir -p $(BUILD_DIR)

$(BUILD_DIR)/.make_done: make_build_dir
	make -C $(BUILD_DIR) -f $(BUILD_SCRIPTS)/$(MAKEFILE)
	date > $@

make_cernlib_dir: $(BUILD_DIR)/.make_done
	test -L $(CERNLIB_DIR) || ln -s $(BUILD_DIR)/$(CERNLIB_VERSION) $(CERNLIB_DIR)
